{% extends 'base.html' %}
{% load static %}
{% block body %}

{% if proj %}

<div style="margin-top:0;display:table">
<div style="margin-top:0;display:table-row">
<div style="margin-top:0;display:table-cell;vertical-align:top">
<!--> <div style="margin-top:0;display:table-cell;vertical-align:top"></-->

<video id="video" width="720px" height="405px" controls></video>

<script type="text/javascript">
var video = document.getElementById('video');
var source = document.createElement('source');
video.appendChild(source);
var titre = document.getElementById('titre_video');
var current = 0;

var playlist = []
{% for r in proj.relation_proj_set.all %}
playlist[{{ forloop.counter }}] = ['{{ r.video.titre }}', '{{r.video.url}}']
{% endfor %}

function launch(id) {
	current = id;
	video.pause();

	source.setAttribute('src', playlist[id][1]);
	video.load();
	video.play();
}

video.addEventListener('ended',next,false);
function next(e) {
	current += 1;
	if (current < playlist.length) {
		launch(current);
	}
}

launch(1);
</script>


	<div class="titre_proj_nouv">
		{{ proj.titre }}
	</div>

	<div class="titre_et_vues" id="titre_et_vues_id">

	  <div class="titre_et_vues_titre"> Titre de la vidéo en cours</div>

		<a href="#" class="proj_vid_suiv">Titre de la vidéo suivante
			<img src={% static "admin/img/droite.png" %} alt="caca2" class='proj_vid_suiv_img'>
		</a>

	  <div class="bandeau_haut">

	    <div class="cellule_num_jtx">
	      <div class="numero_jtx">
	        <div class="numero_jtx_text">
	            15
	        </div>
	      </div>
	    </div>

	    <div class="titre_et_vues_auteurs">Auteurs</div>
	    <div class="titre_et_vues_info">Une information pertinente</div>

	    <div class="nb_vues">
			 {{ proj.views }} vues
		 	</div>

	  </div>

	  <hr>

		<div class="titre_et_vues_vues_et_jaime">
	    <div class="titre_et_vues_vues_et_jaime_nb_jaime">
	       {{ nb_jaimes }}
	    </div>

			<div class="titre_et_vues_vues_et_jaime_vues_jaime">

				{% if request.user.is_authenticated %}
				{% if favorite %}
				    <a href="{% url 'remove_favorite_proj' proj_id=proj.id home=0 %}" class="lien_jaime_rouge">
							<div class="titre_et_vues_vues_et_jaime_bouton_jaime_rouge">
							Je n'aime plus
							</div>
						</a>
				{% else %}

				    <a href="{% url 'add_favorite_proj' proj.id %}" class="lien_jaime_vert">
							<div class="titre_et_vues_vues_et_jaime_bouton_jaime_vert">
								J'aime
	            </div>
						</a>
				{% endif %}
				{% endif %}

				</div>
		</div>



		<div class="titre_et_vues_tags">
		Tags :
		{% for r in video.relation_tag_set.all %}
			<a class="tag" href="{% url 'tag' r.tag.id 1 %}">{{ r.tag.titre }}</a>
		{% endfor %}
	  </div>

	</div>




<div class="description_video">
	<div class="titre_et_vues_date">
		Ajoutée le {{ proj.date|date:"d/m/Y" }}
	</div>

  <label for="toggle-1">Afficher les vidéos</label>
  <input type="checkbox" id="toggle-1">

  <div class="description_video_proj">
    <ol>
      {% for r in proj.relation_proj_set.all %}
      <li>
  			<a href="{% url 'video' r.video.id %}" class="proj_video_titre">{{ r.video.titre }}</a>
  			<a onclick="launch({{forloop.counter}})" href="#" class="proj_video_voir">Voir ici</a>
  		</li>
      {% endfor %}
    </ol>
  </div>
</div>



<div class="commentaires_video" id="commentaires_video_id">
  <div class="commentaires_video_titre">
    Commentaires
  </div>

  <div class="commentaires_video_faire">
    {% if request.user.is_authenticated %}

    <form action="{% url 'comment_proj' proj.id %}" method="post">
    {% csrf_token %}
    <textarea name="comment" rows="3" id="comment"></textarea>
    <input type="submit" value="Poster" id='bouton_comment'/>
    </form>

    {% endif %}
  </div>

  {% for r in proj.relation_comment_proj_set.all%}
      <hr>
      <div class="commentaire_nom_date">
        <div class="commentaires_nom">
          {{ r.author.username }}
        </div>
          <div class="commentaires_date">
          le 04/02/2017 à 15h25
          </div>
          <div class="cellule_com_jaime">

            <div class="commentaires_jaime">

              <div class="petit_titre_et_vues_vues_et_jaime_nb_jaime">
                 14
              </div>

              <div class="petit_titre_et_vues_vues_et_jaime_vues_jaime">

                {% if request.user.is_authenticated %}

                    <a href="" class="petit_lien_jaime_rouge">
                      <div class="petit_titre_et_vues_vues_et_jaime_bouton_jaime_rouge">
                      Je n'aime plus
                      </div>
                    </a>


                    <!--
                {% else %}

                    <a href="" class="lien_jaime_vert">
                      <div class="titre_et_vues_vues_et_jaime_bouton_jaime_vert">
                        J'aime
                      </div>
                    </a>
                {% endif %} !-->


                </div>
            </div>
          </div>

      </div>

      <div class="commentaires_commentaires">
        {{ r.comment }}
      </div>
  {% endfor %}
</div>


</div>

<div class="suggestion">
  <div class="container_suggestion">
		{% load app_filters %}
    <h1>Suggestions</h1>

        <div class="liste_videos">
            {% for v in suggestions %}
                <div class="bloc_video">
                  <a href="{% url 'proj' v.id %}">
                  <figure>
                      <img class="proj_image" src="{{v.image}}"/>
                      <figcaption class="legende_vid_duree">
                            {{v|duration_proj}}
                      </figcaption>
                  </figure>
                  </a>

                  <a href="{% url 'proj' v.id %}">
                      <div class="legende_vid_titre">
                          {{v.titre}}
                      </div>
                  </a>

                  <div class="legende_vid_auteur">
                        <a href="#">
                          JTX2015
                        </a>
                        -
                        {{v.views}}
                         vues.
                  </div>
                </div>
              {% endfor %}
        </div>

      </div>
    </div>



</div>
</div>


{% endif %}
{% endblock %}
